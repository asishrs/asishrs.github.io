<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS) | Asish Soudhamma</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=Description content="LoveIt Theme Demo"><link rel=prev href=https://asishrs.com/2018/10/spring-cloud-config-refresh-kafka/><link rel=canonical href=https://asishrs.com/2020/02/aws-lambda-cloudformation/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary"><meta name=twitter:title content="Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)"><meta name=twitter:description content="Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS) In this article, I will show how you can set up a protected API endpoint using AWS Lamda, API Gateway, and automate the deployment of the stack using AWS CloudFormation.
If you don’t have prior knowledge of the resources/components mentioned above, read the high-level description below.
AWS Lambda AWS Lambda lets you run code without provisioning or managing servers."><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/asishrs.com\/2020\/02\/aws-lambda-cloudformation\/"},"image":{"@type":"ImageObject","url":"https:\/\/asishrs.com\/cover.png","width":800,"height":600},"genre":"posts","keywords":"aws, lambda, cloudformation, apigateway, cloud","wordcount":643,"url":"https:\/\/asishrs.com\/2020\/02\/aws-lambda-cloudformation\/","datePublished":"2020-02-01T23:17:25-07:00","dateModified":"2020-02-01T23:17:25-07:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"XXXX","logo":{"@type":"ImageObject","url":"https:\/\/asishrs.com\/logo.png","width":127,"height":40}},"description":""}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/lib/fontawesome-free/all.min.min.css><link rel=stylesheet href=/css/lib/animate/animate.min.min.css></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=navbar-container><div class="navbar-header animated bounceIn"><a href=https://asishrs.com/>Asish Soudhamma</a></div><div class=navbar-menu><a class=menu-item href=https://asishrs.com/posts>Posts</a>
<a class=menu-item href=https://asishrs.com/tags>Tags</a>
<a class=menu-item href=https://asishrs.com/categories>Categories</a>
<a class=menu-item href=https://asishrs.com/about>About</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><nav class=navbar-mobile><div class=navbar-container><div class=navbar-header><div class="navbar-header-title animated bounceIn"><a href=https://asishrs.com/>Asish Soudhamma</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=https://asishrs.com/posts>Posts</a>
<a class=menu-item href=https://asishrs.com/tags>Tags</a>
<a class=menu-item href=https://asishrs.com/categories>Categories</a>
<a class=menu-item href=https://asishrs.com/about>About</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></nav><main class=main><div class=container><article class=post-warp><h1 class="post-title animated flipInX">Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)</h1><div class=post-meta><div class=post-meta-main><a class=author href=https://asishrs.com/ rel=author><i class="fas fa-user-circle fa-fw"></i>Asish Soudhamma&nbsp;</a>
<span class=post-category>included in
<i class="far fa-folder fa-fw"></i><a href=https://asishrs.com/categories/documentation/>Documentation</a></span></div><div class=post-meta-other><i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-02-01>2020-02-01</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>about 643 words&nbsp;
<i class="far fa-clock fa-fw"></i>4 min&nbsp;</div></div><div class=post-content><a class=post-dummy-target id=automated-and-authenticated-apis-stack-using-lambda-api-gateway-and-cloudformation-aws></a><h1>Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)</h1><p>In this article, I will show how you can set up a protected API endpoint using AWS Lamda, API Gateway, and automate the deployment of the stack using AWS CloudFormation.</p><p>If you don’t have prior knowledge of the resources/components mentioned above, read the high-level description below.</p><a class=post-dummy-target id=aws-lambda></a><h1>AWS Lambda</h1><p>AWS Lambda lets you run code without provisioning or managing servers. With Lambda, you can run code for virtually any type of application or backend service — all with zero administration. Read <a href=https://aws.amazon.com/lambda/>more</a></p><a class=post-dummy-target id=amazon-api-gateway></a><h1>Amazon API Gateway</h1><p>Amazon API Gateway is a fully managed service that makes it easy for developers to create, publish, maintain, monitor, and secure APIs at any scale. APIs act as the “front door” for applications to access data, business logic, or functionality from your backend services. Read more</p><a class=post-dummy-target id=aws-cloudformation></a><h1>AWS CloudFormation</h1><p>AWS CloudFormation provides a common language for you to model and provision AWS and third-party application resources in your cloud environment. AWS CloudFormation allows you to use programming languages or a simple text file to model and provision, in an automated and secure manner, all the resources needed for your applications across all regions and accounts. Read <a href=https://aws.amazon.com/cloudformation/>more</a></p><p>In the example, I have a sample inline API service deployed as Lambda and then expose the endpoint from that via the API gateway. For protecting the APIs, I will be using a managed API Key provided by AWS. There are many ways to protect an API endpoint depending on different use cases; I am not going to cover those in this article.</p><a class=post-dummy-target id=cloudformation-template></a><h1>CloudFormation Template</h1><p>Below is the template file, we will be using.</p><p>Let’s take a look at the important definitions.</p><a class=post-dummy-target id=lambda-function></a><h2>Lambda function</h2><p>I am using an inline lambda function based on NodeJS. The function responds with `Hello World!` for the API invocation.</p><a class=post-dummy-target id=api-key></a><h2>API Key</h2><p>As mentioned before, I am using an API Key to protect the API. Below code, block define an API key, Usage Plan, and Usage Plan Key. You can see that I am adding <code>ApiKeyRequired: true</code> as part of the <code>AWS::ApiGateway::Method</code></p><a class=post-dummy-target id=api-gateway></a><h2>API Gateway</h2><p>Defining the Gateway includes many resources, including API stage and Deployment.</p><p>In addition to this, you can also see a couple of IAM groups (<code>AWS::IAM::Role</code>) are defined on the template. One group is for the Gateway to access the Lambda function and another one for Cloud Watch log creation.</p><p>I also defined a few parameters; these are optional.</p><a class=post-dummy-target id=create-the-stack></a><h1>Create the Stack</h1><p>Now that you understand the resource definitions on the template file, we can proceed to create the stack. I am going to create the stack using `aws cli`. Refer <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html>this</a> to setup your `aws cli`. You can also create the stack via <a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1">AWS Console</a></p><a class=post-dummy-target id=validate-the-template-file></a><h4>Validate the template file</h4><p><code>aws cloudformation validate-template — template-body file://stack.yaml</code></p><a class=post-dummy-target id=deploy-the-stack></a><h4>Deploy the stack</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><span class=lnt>1
</span></pre></td><td class=lntd><pre class=chroma>aws cloudformation deploy — stack-name lambda-api — template-file stack.yaml — capabilities CAPABILITY\_IAM</pre></td></tr></table></div></div><p>Once the stack is created, you will below in your console</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></pre></td><td class=lntd><pre class=chroma>Waiting for changeset to be created..
Waiting for stack create/update to complete
Successfully created/updated stack — lambda-api</pre></td></tr></table></div></div><a class=post-dummy-target id=list-the-apis></a><h4>List the APIs</h4><p><code>aws apigateway get-rest-apis</code></p><p>Get the <code>API Id</code> from above and construct your api url using the format <code>https://{restapi_id}.execute-api.{region}.amazonaws.com/{stage_name}/</code></p><p>If you are unsure about the region, you can run <code>aws configure get region</code></p><a class=post-dummy-target id=get-your-api-key></a><h4>Get your API Key</h4><p>Execute below command and copy <code>value</code></p><p><code>aws apigateway get-api-keys — include-value</code></p><a class=post-dummy-target id=invoke-the-api></a><h4>Invoke the API</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></pre></td><td class=lntd><pre class=chroma>curl -X GET \\
https:/{restapi\_id}.execute-api.{region}.amazonaws.com/v1/hello \\
 -H ‘x-api-key: {your api key}’</pre></td></tr></table></div></div><p>For successful requests, you can see a response like below.</p><p><code>Hello World!</code></p><a class=post-dummy-target id=conclusion></a><h1>Conclusion</h1><p>You now have a protected API with a Lambda integration! As a next step, you can replace the inline Lambda function with a real-world Lambda code. You can upload your Lambda functions to the Amazon S3 bucket and use that in your template. Check the S3 example <a href=https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html>here</a> . Good luck!</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>This article is updated with 2020-02-01</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=https://asishrs.com/2020/02/aws-lambda-cloudformation/index.md target=_blank></a></span></div><div class=post-info-share><span><a href="//twitter.com/share?url=https%3a%2f%2fasishrs.com%2f2020%2f02%2faws-lambda-cloudformation%2f&amp;text=Automated%20and%20Authenticated%20APIs%20stack%20using%20Lambda%2c%20API%20Gateway%20and%20Cloudformation%20%28AWS%29&amp;via=asishrs" target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-fw"></i></a><a href="//reddit.com/submit?url=https%3a%2f%2fasishrs.com%2f2020%2f02%2faws-lambda-cloudformation%2f&amp;title=Automated%20and%20Authenticated%20APIs%20stack%20using%20Lambda%2c%20API%20Gateway%20and%20Cloudformation%20%28AWS%29" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-fw"></i></a><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fasishrs.com%2f2020%2f02%2faws-lambda-cloudformation%2f&amp;title=Automated%20and%20Authenticated%20APIs%20stack%20using%20Lambda%2c%20API%20Gateway%20and%20Cloudformation%20%28AWS%29" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin fa-fw"></i></a></span></div></div></div><div class=post-info-more><section><span class=tag><a href=https://asishrs.com/tags/aws/><i class="fas fa-tag fa-fw"></i>aws</a></span>
<span class=tag><a href=https://asishrs.com/tags/lambda/><i class="fas fa-tag fa-fw"></i>lambda</a></span>
<span class=tag><a href=https://asishrs.com/tags/cloudformation/><i class="fas fa-tag fa-fw"></i>cloudformation</a></span>
<span class=tag><a href=https://asishrs.com/tags/apigateway/><i class="fas fa-tag fa-fw"></i>apigateway</a></span>
<span class=tag><a href=https://asishrs.com/tags/cloud/><i class="fas fa-tag fa-fw"></i>cloud</a></span></section><section><span><a href=javascript:window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=https://asishrs.com/>Home</a></span></section></div><div class=post-nav><a href=https://asishrs.com/2018/10/spring-cloud-config-refresh-kafka/ class=prev rel=prev title="Spring Cloud Config Auto Refresh &#43; Custom Kafka topic"><i class="fas fa-angle-left fa-fw"></i>Spring Cloud Config Auto Refresh &#43; Custom Kafka topic</a></div></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://asishrs.com/>Asish Soudhamma</a></span></div></div></footer><script src=/js/lib/jquery/jquery.slim.min.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.min.js></script><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><script src=/js/blog.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-78558344-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span></a></body></html>