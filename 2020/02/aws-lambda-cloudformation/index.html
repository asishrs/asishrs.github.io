<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS) - Asish Soudhamma</title><meta name=Description content="LoveIt Theme Demo"><meta property="og:title" content="Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)"><meta property="og:description" content="In this article, I will show how you can set up a protected API endpoint using AWS Lamda, API Gateway, and automate the deployment of the stack using AWS CloudFormation.
If you don’t have prior knowledge of the resources/components mentioned above, read the high-level description below.
AWS Lambda AWS Lambda lets you run code without provisioning or managing servers. With Lambda, you can run code for virtually any type of application or backend service — all with zero administration."><meta property="og:type" content="article"><meta property="og:url" content="https://asishrs.com/2020/02/aws-lambda-cloudformation/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-02-01T23:17:25-07:00"><meta property="article:modified_time" content="2020-02-01T23:17:25-07:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)"><meta name=twitter:description content="In this article, I will show how you can set up a protected API endpoint using AWS Lamda, API Gateway, and automate the deployment of the stack using AWS CloudFormation.
If you don’t have prior knowledge of the resources/components mentioned above, read the high-level description below.
AWS Lambda AWS Lambda lets you run code without provisioning or managing servers. With Lambda, you can run code for virtually any type of application or backend service — all with zero administration."><meta name=application-name content="Asish Soudhamma"><meta name=apple-mobile-web-app-title content="Asish Soudhamma"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://asishrs.com/2020/02/aws-lambda-cloudformation/><link rel=prev href=https://asishrs.com/2018/10/spring-cloud-config-refresh-kafka/><link rel=next href=https://asishrs.com/2020/02/hugo-githubactions/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/asishrs.com\/2020\/02\/aws-lambda-cloudformation\/"},"genre":"posts","keywords":"aws, lambda, cloudformation, apigateway, cloud","wordcount":631,"url":"https:\/\/asishrs.com\/2020\/02\/aws-lambda-cloudformation\/","datePublished":"2020-02-01T23:17:25-07:00","dateModified":"2020-02-01T23:17:25-07:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Asish Soudhamma"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Asish Soudhamma"><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts>Posts </a><a class=menu-item href=/tags>Tags </a><a class=menu-item href=/categories>Categories </a><a class=menu-item href=/about>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Asish Soudhamma"><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts title>Posts</a><a class=menu-item href=/tags title>Tags</a><a class=menu-item href=/categories title>Categories</a><a class=menu-item href=/about title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Asish Soudhamma</a></span>&nbsp;<span class=post-category>included in <a href=/categories/documentation/><i class="far fa-folder fa-fw" aria-hidden=true></i>Documentation</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2020-02-01>2020-02-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;631 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class=content id=content><img class="cp t u fz ak" src=/images/posts/aws-lambda-cf/lambda-cloud-formation.png role=presentation><p>In this article, I will show how you can set up a protected API endpoint using AWS Lamda, API Gateway, and automate the deployment of the stack using AWS CloudFormation.</p><p>If you don’t have prior knowledge of the resources/components mentioned above, read the high-level description below.</p><h1 id=aws-lambda>AWS Lambda</h1><p>AWS Lambda lets you run code without provisioning or managing servers. With Lambda, you can run code for virtually any type of application or backend service — all with zero administration. Read <a href=https://aws.amazon.com/lambda/ target=_blank rel="noopener noreffer">more</a></p><h1 id=amazon-api-gateway>Amazon API Gateway</h1><p>Amazon API Gateway is a fully managed service that makes it easy for developers to create, publish, maintain, monitor, and secure APIs at any scale. APIs act as the “front door” for applications to access data, business logic, or functionality from your backend services. Read more</p><h1 id=aws-cloudformation>AWS CloudFormation</h1><p>AWS CloudFormation provides a common language for you to model and provision AWS and third-party application resources in your cloud environment. AWS CloudFormation allows you to use programming languages or a simple text file to model and provision, in an automated and secure manner, all the resources needed for your applications across all regions and accounts. Read <a href=https://aws.amazon.com/cloudformation/ target=_blank rel="noopener noreffer">more</a></p><p>In the example, I have a sample inline API service deployed as Lambda and then expose the endpoint from that via the API gateway. For protecting the APIs, I will be using a managed API Key provided by AWS. There are many ways to protect an API endpoint depending on different use cases; I am not going to cover those in this article.</p><h1 id=cloudformation-template>CloudFormation Template</h1><p>Below is the template file, we will be using.</p><p>Let’s take a look at the important definitions.</p><h2 id=lambda-function>Lambda function</h2><p>I am using an inline lambda function based on NodeJS. The function responds with `Hello World!` for the API invocation.</p><h2 id=api-key>API Key</h2><p>As mentioned before, I am using an API Key to protect the API. Below code, block define an API key, Usage Plan, and Usage Plan Key. You can see that I am adding <code>ApiKeyRequired: true</code> as part of the <code>AWS::ApiGateway::Method</code></p><h2 id=api-gateway>API Gateway</h2><p>Defining the Gateway includes many resources, including API stage and Deployment.</p><p>In addition to this, you can also see a couple of IAM groups (<code>AWS::IAM::Role</code>) are defined on the template. One group is for the Gateway to access the Lambda function and another one for Cloud Watch log creation.</p><p>I also defined a few parameters; these are optional.</p><h1 id=create-the-stack>Create the Stack</h1><p>Now that you understand the resource definitions on the template file, we can proceed to create the stack. I am going to create the stack using `aws cli`. Refer <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html target=_blank rel="noopener noreffer">this</a> to setup your `aws cli`. You can also create the stack via <a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1" target=_blank rel="noopener noreffer">AWS Console</a></p><h4 id=validate-the-template-file>Validate the template file</h4><p><code>aws cloudformation validate-template — template-body file://stack.yaml</code></p><h4 id=deploy-the-stack>Deploy the stack</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aws cloudformation deploy — stack-name lambda-api — template-file stack.yaml — capabilities CAPABILITY\_IAM
</span></span></code></pre></td></tr></table></div></div><p>Once the stack is created, you will below in your console</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Waiting for changeset to be created..
</span></span><span class=line><span class=cl>Waiting for stack create/update to complete
</span></span><span class=line><span class=cl>Successfully created/updated stack — lambda-api
</span></span></code></pre></td></tr></table></div></div><h4 id=list-the-apis>List the APIs</h4><p><code>aws apigateway get-rest-apis</code></p><p>Get the <code>API Id</code> from above and construct your api url using the format <code>https://{restapi_id}.execute-api.{region}.amazonaws.com/{stage_name}/</code></p><p>If you are unsure about the region, you can run <code>aws configure get region</code></p><h4 id=get-your-api-key>Get your API Key</h4><p>Execute below command and copy <code>value</code></p><p><code>aws apigateway get-api-keys — include-value</code></p><h4 id=invoke-the-api>Invoke the API</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>curl -X GET \\
</span></span><span class=line><span class=cl>https:/{restapi\_id}.execute-api.{region}.amazonaws.com/v1/hello \\
</span></span><span class=line><span class=cl> -H ‘x-api-key: {your api key}’
</span></span></code></pre></td></tr></table></div></div><p>For successful requests, you can see a response like below.</p><p><code>Hello World!</code></p><h1 id=conclusion>Conclusion</h1><p>You now have a protected API with a Lambda integration! As a next step, you can replace the inline Lambda function with a real-world Lambda code. You can upload your Lambda functions to the Amazon S3 bucket and use that in your template. Check the S3 example <a href=https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html target=_blank rel="noopener noreffer">here</a> . Good luck!</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-02-01</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://asishrs.com/2020/02/aws-lambda-cloudformation/ data-title="Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)" data-hashtags=aws,lambda,cloudformation,apigateway,cloud><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://asishrs.com/2020/02/aws-lambda-cloudformation/ data-hashtag=aws><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://asishrs.com/2020/02/aws-lambda-cloudformation/ data-title="Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://asishrs.com/2020/02/aws-lambda-cloudformation/ data-title="Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://asishrs.com/2020/02/aws-lambda-cloudformation/ data-title="Automated and Authenticated APIs stack using Lambda, API Gateway and Cloudformation (AWS)"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/aws/>aws</a>,&nbsp;<a href=/tags/lambda/>lambda</a>,&nbsp;<a href=/tags/cloudformation/>cloudformation</a>,&nbsp;<a href=/tags/apigateway/>apigateway</a>,&nbsp;<a href=/tags/cloud/>cloud</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2018/10/spring-cloud-config-refresh-kafka/ class=prev rel=prev title="Spring Cloud Config Auto Refresh + Custom Kafka topic"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Spring Cloud Config Auto Refresh + Custom Kafka topic</a>
<a href=/2020/02/hugo-githubactions/ class=next rel=next title="Automate your GitHub Pages Deployment using Hugo and Actions">Automate your GitHub Pages Deployment using Hugo and Actions<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Asish Soudhamma</a></span>&nbsp;|&nbsp;<span class=license>MIT</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},data:{"id-1":"⌂","id-2":"⌂"},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:100}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>